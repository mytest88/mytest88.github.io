<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta http-equiv="X-UA-Compatible" content="ie=edge" />
    <title>Automated SOC with SOAR Implementation</title>
    <meta name="description" content="Case study page of Automated SOC with SOAR Implementation Project" />
    <link rel="stylesheet" href="css/style.css" />
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link href="https://fonts.googleapis.com/css2?family=Source+Sans+Pro:wght@400;600;700;900&display=swap" rel="stylesheet" />
    <style>
      .constrained-image {
        display: block;
        width: 100%;
        height: auto;
        cursor: pointer; /* Add a pointer cursor on hover */
        transition: transform 0.2s ease;
      }

      .constrained-image.larger {
        max-width: 1890px;
        max-height: 1100px;
      }

      .constrained-image:hover {
        transform: scale(1.03);
      }

      .project-details__img-cont {
        margin-bottom: 2rem;
        text-align: center;
      }

      /* The Modal (background) */
      .modal {
        display: none; /* Hidden by default */
        position: fixed; /* Stay in place */
        z-index: 1000; /* Sit on top */
        left: 0;
        top: 0;
        width: 100%; /* Full width */
        height: 100%; /* Full height */
        overflow: auto; /* Enable scroll if needed */
        background-color: rgba(0, 0, 0, 0.9); /* Black with opacity */
        display: flex;
        justify-content: center;
        align-items: center;
      }

      /* Modal Content (image) */
      .modal-content {
        /* margin: auto; */
        display: block;
        /* width: 80%; */
        max-width: 90%;
        max-height: 90%;
      }

      /* Close Button */
      .close {
        position: absolute;
        top: 15px;
        right: 35px;
        color: #f1f1f1;
        font-size: 40px;
        font-weight: bold;
        transition: color 0.3s;
        cursor: pointer;
      }

      .close:hover,
      .close:focus {
        color: #bbb;
        text-decoration: none;
      }
      code {
        background-color: #eee; /* Light background for code */
        padding: 2px 4px;
        border-radius: 3px;
        font-family: 'Source Code Pro', monospace; /* Monospaced font for code */
        font-size: 0.9em; /* Slightly smaller than surrounding text */
      }
    </style>
  </head>
  <body>
    <header class="header">
      <div class="header__content">
        <div class="header__logo-container">
          <a href="./index.html">
            <div class="header__logo-img-cont">
              <img src="./assets/png/john-doe.png" alt="Ram Maheshwari Logo Image" class="header__logo-img" />
            </div>
            <span class="header__logo-sub">John Doe</span>
          </a>
        </div>
        <div class="header__main">
          <ul class="header__links">
            <li class="header__link-wrapper">
              <a href="./index.html" class="header__link"> Home </a>
            </li>
            <li class="header__link-wrapper">
              <a href="./index.html#about" class="header__link">About </a>
            </li>
            <li class="header__link-wrapper">
              <a href="./index.html#projects" class="header__link">
                Projects
              </a>
            </li>
            <li class="header__link-wrapper">
              <a href="./index.html#contact" class="header__link"> Contact </a>
            </li>
          </ul>
          <div class="header__main-ham-menu-cont">
            <img src="./assets/svg/ham-menu.svg" alt="hamburger menu" class="header__main-ham-menu" />
            <img src="./assets/svg/ham-menu-close.svg" alt="hamburger menu close d-none" class="header__main-ham-menu-close d-none" />
          </div>
        </div>
      </div>
      <div class="header__sm-menu">
        <div class="header__sm-menu-content">
          <ul class="header__sm-menu-links">
            <li class="header__sm-menu-link">
              <a href="./index.html"> Home </a>
            </li>
            <li class="header__sm-menu-link">
              <a href="./index.html#about"> About </a>
            </li>
            <li class="header__sm-menu-link">
              <a href="./index.html#projects"> Projects </a>
            </li>
            <li class="header__sm-menu-link">
              <a href="./index.html#contact"> Contact </a>
            </li>
          </ul>
        </div>
      </div>
    </header>
    <section class="project-cs-hero">
      <div class="project-cs-hero__content">
        <h1 class="heading-primary">Automated SOC with SOAR Implementation</h1>
        <div class="project-cs-hero__info">
          <p class="text-primary">
            In this project, I established and deployed a fully automated Security Operations Center (SOC) within a virtual lab environment. The primary challenge addressed was the inherent inefficiency of manual incident detection and response. My solution integrates Wazuh (XDR/EDR) for comprehensive endpoint monitoring, TheHive (Incident Response) for organized incident management, and Shuffle (SOAR) for orchestrating automated workflows.
          </p>
        </div>
        <div class="project-cs-hero__cta">
          <a href="#" class="btn btn--bg" target="_blank">Live Link</a>
        </div>
      </div>
    </section>
    <section class="project-details">
      <div class="main-container">
        <div class="project-details__content">
          <div class="project-details__showcase-img-cont">
            <img src="./assets/jpeg/project-mockup-example.jpeg" alt="Project Image" class="project-details__showcase-img" />
          </div>
          <div class="project-details__content-main">
            <div class="project-details__desc">
              <h3 class="project-details__content-title">Project Overview</h3>
              <p class="project-details__desc-para">
                In this project, I established and deployed a fully automated Security Operations Center (SOC) within a virtual lab environment. The primary challenge addressed was the inherent inefficiency of manual incident detection and response. My solution integrates Wazuh (XDR/EDR) for comprehensive endpoint monitoring, TheHive (Incident Response) for organized incident management, and Shuffle (SOAR) for orchestrating automated workflows. By leveraging Sysmon logs and crafting custom rules, I built a robust system capable of simulating, detecting, and responding to advanced threats like Mimikatz in real-time.
              </p>
              <p class="project-details__desc-para">
                This setup showcases my proactive approach, transforming raw security events into actionable intelligence and automating critical response actions. Wazuh successfully detected the threat, and the custom integration script seamlessly forwarded the alert to TheHive for immediate case management. Furthermore, automated email notifications were dispatched to the SOC analyst, facilitating rapid case management. This automated alert creation significantly reduces response time and ensures critical incidents are promptly addressed, highlighting my ability to construct resilient and efficient security operations.
              </p>
            </div>
            <div class="project-details__subsections">
              <h3 class="project-details__content-title">Key Skills Demonstrated</h3>
              <p class="project-details__desc-para">
                Wazuh, TheHive, Shuffle, Sysmon, SOAR, XDR, EDR, log analysis, alert automation, incident response, rule creation, virtualization, API integration, troubleshooting, playbook, and workflow orchestration.
              </p>
              <h3 class="project-details__content-title">Workflow</h3>
              <p class="project-details__desc-para">
                The project workflow minimizes manual intervention, ensuring that critical security incidents are detected, enriched with threat intelligence, escalated for case management, and communicated to the response team with unparalleled speed and efficiency. The success of this project stems from a carefully designed automated workflow, guaranteeing rapid and consistent incident response.
              </p>
              <p class="project-details__desc-para">
                Here's a breakdown of the automated process:
              </p>
              <h4>Endpoint Monitoring & Log Ingestion</h4>
              <p class="project-details__desc-para">
                A Windows 10 endpoint, equipped with Sysmon, generates security events. The Wazuh agent on this endpoint collects these Sysmon operational logs and forwards them to the Wazuh Manager. Wazuh is configured to ingest and archive all raw logs into Elasticsearch for comprehensive visibility and future analysis.
              </p>
              <h4>Threat Detection & Custom Rule Creation</h4>
              <p class="project-details__desc-para">
                To detect specific threats like Mimikatz, I developed and implemented a custom Wazuh rule. This rule precisely identifies Mimikatz execution based on <code>originalFileName</code> within Sysmon event data, assigning a critical severity level and linking it to MITRE ATT&CK T1003 (OS Credential Dumping). Upon Mimikatz execution, Wazuh immediately generates a high-fidelity alert.
              </p>
              <h4>Automated Incident Creation in TheHive</h4>
              <p class="project-details__desc-para">
                I developed and deployed a custom Python integration script on the Wazuh Manager. This script is configured in <code>ossec.conf</code> to automatically forward critical Wazuh alerts, including our Mimikatz detection, directly to TheHive. TheHive receives these alerts and automatically creates new cases for incident management, populating them with all relevant details from the Wazuh alert.
              </p>
              <h4>SOAR Orchestration & Threat Intelligence Enrichment (Shuffle)</h4>
              <p class="project-details__desc-para">
                Wazuh alerts are also forwarded to Shuffle via a dedicated webhook. Shuffle's workflow automatically extracts the SHA256 hash from the Mimikatz alert data using a regex capture group. This extracted hash is then used to query VirusTotal via its API, enriching the alert with real-time threat intelligence and confirming the malicious nature of the executable.
              </p>
              <h4>Automated Analyst Notification</h4>
              <p class="project-details__desc-para">
                As the final step in the Shuffle workflow, an automated email notification is sent to the analyst. This email, populated with critical alert details (e.g., alert title, filename, affected host), ensures immediate awareness and prompts the analyst to initiate their investigation in TheHive.
              </p>
              <p class="project-details__desc-para">
                Let's get started!
              </p>

              <div class="project-details__img-cont">
                <img src="/assets/Automated SOC with SOAR Implementation/0diagram.png" alt="Lab Network Setup Diagram" class="constrained-image" onclick="showOriginal(this)" />
              </div>
              <p class="project-details__desc-para">
                This diagram illustrates the lab's network setup: A Windows 10 endpoint generates security events, which are monitored by Wazuh (XDR/EDR). TheHive (incident management) and Shuffle (SOAR) are integrated to manage and automate responses, with the Analyst PC used for monitoring and analysis.
              </p>

              <h3 class="project-details__content-title">Installing Wazuh</h3>
              <p class="project-details__desc-para">
                We begin by installing Wazuh, the XDR/EDR platform, to establish core security monitoring and detection capabilities. The installation was performed using the official Wazuh script: <code>curl -sO https://packages.wazuh.com/4.12/wazuh-install.sh && sudo bash ./wazuh-install.sh -a</code>
              </p>
              <div class="project-details__img-cont">
                <img src="/assets/Automated SOC with SOAR Implementation/1installing-wazuh.png" alt="Wazuh Installation Screenshot" class="constrained-image" onclick="showOriginal(this)" />
              </div>

              <p class="project-details__desc-para">
                To access the Wazuh dashboard, I first confirmed the IP address of the Wazuh service. The <code>ifconfig</code> output revealed <code>192.168.10.11</code> as the assigned IP, which was then used for web interface access.
              </p>
              <div class="project-details__img-cont">
                <img src="/assets/Automated SOC with SOAR Implementation/2ip.png" alt="Wazuh IP Address Configuration" class="constrained-image" onclick="showOriginal(this)" />
              </div>
              <div class="project-details__img-cont">
                <img src="/assets/Automated SOC with SOAR Implementation/3wazuh.png" alt="Wazuh Dashboard Initial View" class="constrained-image" onclick="showOriginal(this)" />
              </div>

              <p class="project-details__desc-para">
                With Wazuh installed, the next step is to deploy an agent to the Windows 10 endpoint. As seen here, the dashboard currently shows no registered agents, prompting the "Deploy new agent" action to begin monitoring the endpoint.
              </p>
              <div class="project-details__img-cont">
                <img src="/assets/Automated SOC with SOAR Implementation/4deploy-wazuh-agent.png" alt="Deploy New Wazuh Agent" class="constrained-image" onclick="showOriginal(this)" />
              </div>

              <h4>Configuring Agent Deployment</h4>
              <p class="project-details__desc-para">
                To deploy the Wazuh agent to the Windows 10 endpoint, the server address <code>192.168.10.11</code> was assigned. An agent name, <code>myLab</code>, was also provided during this configuration step to uniquely identify the endpoint within Wazuh.
              </p>
              <div class="project-details__img-cont">
                <img src="/assets/Automated SOC with SOAR Implementation/5deploy-agent.png" alt="Wazuh Agent Deployment Configuration" class="constrained-image" onclick="showOriginal(this)" />
              </div>

              <p class="project-details__desc-para">
                The Wazuh dashboard provides the specific PowerShell commands to download and install the agent on the Windows 10 endpoint. This includes the <code>Invoke-WebRequest</code> command to retrieve the installer and <code>msiexec.exe</code> for silent installation, ensuring the agent connects to the Wazuh Manager at <code>192.168.10.11</code> and is named <code>myLab</code>. Following this, <code>NET START WazuhSvc</code> starts the agent service.
              </p>
              <div class="project-details__img-cont">
                <img src="/assets/Automated SOC with SOAR Implementation/6-deploying-command.png" alt="Wazuh Agent Deployment Commands" class="constrained-image" onclick="showOriginal(this)" />
              </div>

              <p class="project-details__desc-para">
                After running the deployment commands on the Windows 10 endpoint, the Wazuh agent successfully registered. The dashboard now displays "myLab" (<code>192.168.10.10</code>) as an active agent, confirming it is now sending security data for monitoring.
              </p>
              <div class="project-details__img-cont">
                <img src="/assets/Automated SOC with SOAR Implementation/7-node.png" alt="Wazuh Active Agent Display" class="constrained-image" onclick="showOriginal(this)" />
              </div>

              <h3 class="project-details__content-title">Installing TheHive Dependencies (Java)</h3>
              <p class="project-details__desc-para">
                Next, we proceed with installing TheHive, the incident response platform. We are going to follow the official guide of TheHive: <a href="https://docs.strangebee.com/thehive/installation/step-by-step-installation-guide/" target="_blank">https://docs.strangebee.com/thehive/installation/step-by-step-installation-guide/</a>. This begins by ensuring all necessary Java dependencies are in place.
              </p>
              <div class="project-details__img-cont">
                <img src="/assets/Automated SOC with SOAR Implementation/8-java.png" alt="Java Dependencies Installation for TheHive" class="constrained-image" onclick="showOriginal(this)" />
              </div>

              <p class="project-details__desc-para">
                TheHive relies on Apache Cassandra for its distributed database.
              </p>
              <div class="project-details__img-cont">
                <img src="/assets/Automated SOC with SOAR Implementation/9-cassandra-status.png" alt="Apache Cassandra Status" class="constrained-image" onclick="showOriginal(this)" />
              </div>

              <p class="project-details__desc-para">
                Elasticsearch is another dependency for TheHive, providing powerful search and analytics capabilities for incident data.
              </p>
              <div class="project-details__img-cont">
                <img src="/assets/Automated SOC with SOAR Implementation/10-elasticsearch-status.png" alt="Elasticsearch Status" class="constrained-image" onclick="showOriginal(this)" />
              </div>

              <p class="project-details__desc-para">
                Now we are good to go for installing TheHive. After installing TheHive, it's crucial to correctly set file permissions to ensure proper operation and security. As shown in the <code>ls -la /opt/thp</code> output, the directory initially shows <code>root</code> as the owner. The official documentation mandates changing these permissions to <code>thehive:thehive</code>.
              </p>
              <div class="project-details__img-cont">
                <img src="/assets/Automated SOC with SOAR Implementation/11-root-owner.png" alt="TheHive File Permissions - Root Owner" class="constrained-image" onclick="showOriginal(this)" />
              </div>

              <p class="project-details__desc-para">
                To align with TheHive's operational requirements, the file ownership for <code>/opt/thp</code> was changed recursively to <code>thehive:thehive</code> using the <code>chown -R thehive:thehive /opt/thp</code> command.
              </p>
              <div class="project-details__img-cont">
                <img src="/assets/Automated SOC with SOAR Implementation/12-change-ownership.png" alt="TheHive File Permissions - Changing Ownership" class="constrained-image" onclick="showOriginal(this)" />
              </div>
              <div class="project-details__img-cont">
                <img src="/assets/Automated SOC with SOAR Implementation/13-change-ownershipU.png" alt="TheHive File Permissions - Updated Ownership" class="constrained-image" onclick="showOriginal(this)" />
              </div>

              <p class="project-details__desc-para">
                With the installation, permission adjustments and configurations complete, TheHive's web interface is now accessible, confirming the successful deployment and readiness for incident management operations.
              </p>
              <div class="project-details__img-cont">
                <img src="/assets/Automated SOC with SOAR Implementation/14-thehive.png" alt="TheHive Web Interface" class="constrained-image" onclick="showOriginal(this)" />
              </div>

              <p class="project-details__desc-para">
                Default credentials for TheHive are: <code>admin@thehive.local</code> - <code>secret</code>. When I tried to login with these credentials, an error occurred, so now we have to solve this.
              </p>
              <div class="project-details__img-cont">
                <img src="/assets/Automated SOC with SOAR Implementation/15-errorHive.png" alt="TheHive Login Error" class="constrained-image" onclick="showOriginal(this)" />
              </div>

              <p class="project-details__desc-para">
                When I checked the Elasticsearch service, I saw that it failed to start due to it being killed by the Out Of Memory (OOM) Killer, indicating insufficient available memory to run the service.
              </p>
              <div class="project-details__img-cont">
                <img src="/assets/Automated SOC with SOAR Implementation/16-esError.png" alt="Elasticsearch OOM Error" class="constrained-image" onclick="showOriginal(this)" />
              </div>

              <h4>Why does the OOM Killer activate?</h4>
              <p class="project-details__desc-para">
                The OOM Killer is a mechanism in the Linux kernel that steps in when the system is critically low on memory. It selects and terminates processes to free up memory and prevent the entire system from crashing or becoming unresponsive. Elasticsearch, especially with default configurations or when handling significant data, can be memory-intensive.
              </p>

              <h4>How to solve this problem:</h4>
              <ol>
                <li><strong>Increase Available Memory</strong>: The most direct solution is to provide more RAM to the machine running Elasticsearch. If possible, upgrade the system's memory.</li>
                <li><strong>Reduce Elasticsearch Memory Usage</strong>: If you can't increase the RAM, you need to configure Elasticsearch to use less memory. This involves adjusting the JVM heap size that Elasticsearch uses.</li>
              </ol>
              <p class="project-details__desc-para">
                My solution: I didn't want to reduce the performance of Elasticsearch, so I increased the RAM of my VM. With the increased RAM, the Elasticsearch service now runs without OOM issues, allowing TheHive to start and authenticate correctly.
              </p>
              <div class="project-details__img-cont">
                <img src="/assets/Automated SOC with SOAR Implementation/17-theHiveLoggedin.png" alt="TheHive Successful Login" class="constrained-image" onclick="showOriginal(this)" />
              </div>

              <h3 class="project-details__content-title">Configuring Wazuh in Win10 Machine</h3>
              <p class="project-details__desc-para">
                To ingest Sysmon logs into Wazuh for comprehensive endpoint monitoring, the full name of the Sysmon operational log (<code>Microsoft-Windows-Sysmon/Operational</code>) is identified within the Event Viewer.
              </p>
              <div class="project-details__img-cont">
                <img src="/assets/Automated SOC with SOAR Implementation/18-sysmonPath.png" alt="Sysmon Log Path" class="constrained-image" onclick="showOriginal(this)" />
              </div>

              <p class="project-details__desc-para">
                To integrate Sysmon logs with Wazuh, I modified the <code>ossec.conf</code> file on the Windows 10 agent. Specifically, I added a <code>&lt;localfile&gt;</code> entry, pointing to the <code>Microsoft-Windows-Sysmon/Operational</code> event channel, ensuring these security events are now collected and forwarded to the Wazuh Manager for analysis.
              </p>
              <div class="project-details__img-cont">
                <img src="/assets/Automated SOC with SOAR Implementation/19-ossecConf.png" alt="Wazuh ossec.conf Sysmon Configuration" class="constrained-image" onclick="showOriginal(this)" />
              </div>

              <p class="project-details__desc-para">
                After modifying the <code>ossec.conf</code> file, I restarted the Wazuh agent service on the Windows 10 endpoint. This ensures the configuration changes take effect immediately, allowing the agent to begin collecting Sysmon logs as configured.
              </p>
              <div class="project-details__img-cont">
                <img src="/assets/Automated SOC with SOAR Implementation/20-restartWazuh.png" alt="Restart Wazuh Agent Service" class="constrained-image" onclick="showOriginal(this)" />
              </div>

              <p class="project-details__desc-para">
                With the Wazuh agent restarted and properly configured, I verified that Sysmon logs are now being successfully ingested and displayed within the Wazuh dashboard. The search filter for "sysmon" confirms that relevant events from the Windows 10 endpoint are actively flowing into the system for monitoring and analysis.
              </p>
              <div class="project-details__img-cont">
                <img src="/assets/Automated SOC with SOAR Implementation/21-sysmon-wazuh.png" alt="Sysmon Logs in Wazuh Dashboard" class="constrained-image" onclick="showOriginal(this)" />
              </div>

              <p class="project-details__desc-para">
                To simulate a real-world threat and test our monitoring capabilities, I executed Mimikatz—a tool commonly used for credential access—on the Windows 10 endpoint. This action is for generating specific security events that Wazuh is configured to detect and log.
              </p>
              <div class="project-details__img-cont">
                <img src="/assets/Automated SOC with SOAR Implementation/22-run-mimikatz.png" alt="Executing Mimikatz" class="constrained-image" onclick="showOriginal(this)" />
              </div>

              <p class="project-details__desc-para">
                After executing Mimikatz, the Wazuh dashboard initially showed "No Results" for "mimikatz" alerts. This confirmed that while Sysmon logs were being collected, Wazuh's default ruleset did not yet contain specific detections for this type of threat, demonstrating the need for custom rule creation to enhance detection capabilities.
              </p>
              <div class="project-details__img-cont">
                <img src="/assets/Automated SOC with SOAR Implementation/23-no-result.png" alt="No Mimikatz Alerts in Wazuh" class="constrained-image" onclick="showOriginal(this)" />
              </div>

              <p class="project-details__desc-para">
                It's time to configure Wazuh. But before modifying Wazuh's core configuration, I wanted to create a backup of the existing <code>ossec.conf</code> file to ensure the ability to restore the original configuration if needed, minimizing disruption during rule development and testing.
              </p>
              <div class="project-details__img-cont">
                <img src="/assets/Automated SOC with SOAR Implementation/24-copy-conf.png" alt="Backup ossec.conf" class="constrained-image" onclick="showOriginal(this)" />
              </div>

              <p class="project-details__desc-para">
                To ensure all raw logs, including those that do not immediately trigger an alert, are stored for later analysis, I modified the <code>ossec.conf</code> file. Specifically, I changed the <code>logall</code> and <code>logall_json</code> parameters from "no" to "yes" within the global configuration. This enables full fidelity logging, which is essential for detailed investigations and custom rule development.
              </p>
              <div class="project-details__img-cont">
                <img src="/assets/Automated SOC with SOAR Implementation/25-configured-file.png" alt="Configuring Full Fidelity Logging in ossec.conf" class="constrained-image" onclick="showOriginal(this)" />
              </div>

              <p class="project-details__desc-para">
                To complement the full log collection enabled in Wazuh, I modified the <code>filebeat.yml</code> configuration. Specifically, I set <code>archives: enabled</code> to <code>true</code> under the <code>filebeat.modules.wazuh.alerts</code> section. This ensures that raw, non-alerting logs, which are critical for in-depth analysis and custom rule creation, are also ingested into Elasticsearch for comprehensive visibility.
                <code>systemctl restart filebeat</code>
              </p>
              <div class="project-details__img-cont">
                <img src="/assets/Automated SOC with SOAR Implementation/26-filebeat-conf.png" alt="Filebeat Configuration for Archival Logs" class="constrained-image" onclick="showOriginal(this)" />
              </div>

              <p class="project-details__desc-para">
                To prepare for analyzing the newly enabled full logs, I navigated to "Dashboards Management" within the Wazuh interface, then selected "Index patterns" to create a new index pattern. This is the next step to ensure that the raw log data, including archival logs, is properly indexed and searchable for analysis. However, this gave me an error. I tried to create a new index pattern with a single <code>*</code>, then it worked.
              </p>
              <div class="project-details__img-cont">
                <img src="/assets/Automated SOC with SOAR Implementation/27-index1.png" alt="Wazuh Index Pattern Creation Step 1" class="constrained-image" onclick="showOriginal(this)" />
              </div>
              <div class="project-details__img-cont">
                <img src="/assets/Automated SOC with SOAR Implementation/27-index2.png" alt="Wazuh Index Pattern Creation Step 2" class="constrained-image" onclick="showOriginal(this)" />
              </div>
              <div class="project-details__img-cont">
                <img src="/assets/Automated SOC with SOAR Implementation/27-index3.png" alt="Wazuh Index Pattern Creation Step 3" class="constrained-image" onclick="showOriginal(this)" />
              </div>
              <div class="project-details__img-cont">
                <img src="/assets/Automated SOC with SOAR Implementation/28-index4Error.png" alt="Wazuh Index Pattern Creation Error" class="constrained-image" onclick="showOriginal(this)" />
              </div>
              <div class="project-details__img-cont">
                <img src="/assets/Automated SOC with SOAR Implementation/29-indexPattern.png" alt="Wazuh Index Pattern Created" class="constrained-image" onclick="showOriginal(this)" />
              </div>

              <p class="project-details__desc-para">
                To confirm that Sysmon successfully captured the Mimikatz execution and Wazuh archived the raw event, I used <code>cat archives.json</code> piped through <code>grep -i mimikatz</code>. The output clearly shows the detailed Sysmon event logs related to the Mimikatz process, confirming that our comprehensive logging setup is effectively collecting even non-alerting security events. This data is now available for further analysis and custom rule creation.
              </p>
              <div class="project-details__img-cont">
                <img src="/assets/Automated SOC with SOAR Implementation/30-check-logs.png" alt="Checking Archived Logs for Mimikatz" class="constrained-image" onclick="showOriginal(this)" />
              </div>

              <p class="project-details__desc-para">
                After enabling full log collection and verifying the raw <code>archives.json</code> file, I searched the Wazuh dashboard's "wazuh-archives-*" index for "mimikatz" events. The successful query, showing "11 hits" and displaying the detailed Sysmon logs related to Mimikatz execution, confirms that the raw, non-alerting events are now fully searchable and accessible within the Wazuh interface.
              </p>
              <div class="project-details__img-cont">
                <img src="/assets/Automated SOC with SOAR Implementation/31-wazuh-dashboard-hit.png" alt="Mimikatz Events in Wazuh Dashboard" class="constrained-image" onclick="showOriginal(this)" />
              </div>

              <p class="project-details__desc-para">
                To create a custom rule for Mimikatz detection, I navigated to "Server Management" -> "Rules" -> "Manage Rule Files" in the Wazuh dashboard. Here, I identified <code>0800-sysmon_id_1.xml</code> as the appropriate file within the <code>ruleset/rules</code> directory. This is where we'll add our specific detection logic for the Mimikatz activity.
              </p>
              <div class="project-details__img-cont">
                <img src="/assets/Automated SOC with SOAR Implementation/32-manage-rules.png" alt="Wazuh Rule Management" class="constrained-image" onclick="showOriginal(this)" />
              </div>

              <p class="project-details__desc-para">
                Copy one of them to build your custom rule.
                Create custom rule -> local_rules -> paste here.
              </p>
              <div class="project-details__img-cont">
                <img src="/assets/Automated SOC with SOAR Implementation/33-rule-file.png" alt="Creating Custom Rule File" class="constrained-image" onclick="showOriginal(this)" />
              </div>

              <p class="project-details__desc-para">
                Before defining the custom detection rule, I analyzed the archived Mimikatz logs in the Wazuh dashboard. Specifically, I extracted the <code>data.win.eventdata.originalFileName</code> field, which contains "mimikatz.exe". This unique and reliable indicator will be used as a key element in our custom rule to accurately detect future Mimikatz executions.
              </p>
              <div class="project-details__img-cont">
                <img src="/assets/Automated SOC with SOAR Implementation/34-json-rule.png" alt="Analyzing Mimikatz Log for Custom Rule" class="constrained-image" onclick="showOriginal(this)" />
              </div>

              <p class="project-details__desc-para">
                With the relevant log data identified, I crafted a custom rule within <code>local_rules.xml</code> to detect Mimikatz execution. This rule is designed with the highest critical <code>level="15"</code> and specifically targets <code>originalFileName</code> for "mimikatz.exe" (case-insensitive). I also linked it to MITRE ATT&CK T1003 (OS Credential Dumping), providing immediate threat context.
              </p>
              <div class="project-details__img-cont">
                <img src="/assets/Automated SOC with SOAR Implementation/35-custom-rule-created.png" alt="Custom Mimikatz Detection Rule" class="constrained-image" onclick="showOriginal(this)" />
              </div>

              <p class="project-details__desc-para">
                Now it's time to test. Here's Wazuh dashboard before I re-executed <code>mimikatz.exe</code>.
              </p>
              <div class="project-details__img-cont">
                <img src="/assets/Automated SOC with SOAR Implementation/36-before-mimikatz.png" alt="Wazuh Dashboard Before Mimikatz Execution" class="constrained-image" onclick="showOriginal(this)" />
              </div>

              <p class="project-details__desc-para">
                Executing <code>mimikatz.exe</code>.
              </p>
              <div class="project-details__img-cont">
                <img src="/assets/Automated SOC with SOAR Implementation/37-run-mimikatz.png" alt="Executing Mimikatz" class="constrained-image" onclick="showOriginal(this)" />
              </div>

              <p class="project-details__desc-para">
                After restarting the Wazuh manager and re-executing Mimikatz on the Windows 10 endpoint, our custom detection rule immediately triggered a high-severity alert. As highlighted, the Wazuh dashboard now displays a new event with <code>rule.mitre.id</code> as <code>T1003</code> (Credential Access) and <code>rule.description</code> clearly stating "Mimikatz Usage Detected!!!".
              </p>
              <div class="project-details__img-cont">
                <img src="/assets/Automated SOC with SOAR Implementation/38-wazuh-detected.png" alt="Wazuh Mimikatz Detection Alert" class="constrained-image" onclick="showOriginal(this)" />
              </div>
              <div class="project-details__img-cont">
                <img src="/assets/Automated SOC with SOAR Implementation/39-wazuh-mimikatz-rule.png" alt="Wazuh Mimikatz Rule Details" class="constrained-image" onclick="showOriginal(this)" />
              </div>

              <h3 class="project-details__content-title">Integrating SOAR</h3>
              <p class="project-details__desc-para">
                Now, to enable automated incident response, I'm integrating Shuffle, our SOAR platform, with Wazuh. This screenshot shows the initial configuration within Shuffle, where I'm setting up a new "Wazuh-alerts" webhook. The critical step here is obtaining the unique "Webhook URI" (<code>https://shuffler.io/api/v1/hooks/webhook</code>), which will act as the communication channel for Wazuh alerts to be sent to Shuffle for orchestration and automation. This setup lays the groundwork for Shuffle to receive and process security alerts. I'm going to follow <a href="https://wazuh.com/blog/integrating-wazuh-with-shuffle/" target="_blank">https://wazuh.com/blog/integrating-wazuh-with-shuffle/</a>.
              </p>
              <div class="project-details__img-cont">
                <img src="/assets/Automated SOC with SOAR Implementation/40-shuffle.png" alt="Shuffle Webhook Configuration" class="constrained-image" onclick="showOriginal(this)" />
              </div>

              <p class="project-details__desc-para">
                To bridge Wazuh and Shuffle, I modified the <code>ossec.conf</code> file on the Wazuh Manager, adding an <code>&lt;integration&gt;</code> block. As highlighted, this configuration directs Wazuh to forward alerts to Shuffle's webhook URI, specifically including our custom Mimikatz alert (<code>rule_id 100002</code>). By specifying <code>alert_format</code> as <code>json</code>, we ensure the alerts are sent in a structured format, enabling seamless parsing and automation within Shuffle.
              </p>
              <div class="project-details__img-cont">
                <img src="/assets/Automated SOC with SOAR Implementation/41-ossec-shuffle.png" alt="Wazuh ossec.conf Integration with Shuffle" class="constrained-image" onclick="showOriginal(this)" />
              </div>

              <p class="project-details__desc-para">
                Following the <code>ossec.conf</code> modifications and restarting the Wazuh service, I initiated the Shuffle webhook. The screenshot confirms its successful activation, displaying "Webhook: running" and a notification indicating "Successfully started webhook".
              </p>
              <div class="project-details__img-cont">
                <img src="/assets/Automated SOC with SOAR Implementation/42-running-shuffle.png" alt="Shuffle Webhook Running" class="constrained-image" onclick="showOriginal(this)" />
              </div>

              <p class="project-details__desc-para">
                Here, we can test the workflow.
              </p>
              <div class="project-details__img-cont">
                <img src="/assets/Automated SOC with SOAR Implementation/43-workflow.png" alt="Shuffle Workflow Test" class="constrained-image" onclick="showOriginal(this)" />
              </div>

              <p class="project-details__desc-para">
                I re-executed Mimikatz on the Windows 10 endpoint. The screenshot confirms that the alert was successfully ingested by Shuffle, showing a "FINISHED" status for the webhook event. Critically, the JSON payload reveals our custom <code>rule_id</code>: "100002", a "Mimikatz Usage Detected!!!" title, and associated details like <code>severity: 3</code>. This validates the seamless flow of high-fidelity alerts from Wazuh to Shuffle, confirming our SOAR platform is ready to automate responses based on critical security events.
              </p>
              <div class="project-details__img-cont">
                <img src="/assets/Automated SOC with SOAR Implementation/44-shuffle-detected.png" alt="Shuffle Ingested Mimikatz Alert" class="constrained-image" onclick="showOriginal(this)" />
              </div>

              <p class="project-details__desc-para">
                To enrich the alert data and facilitate threat intelligence lookups, the automated workflow needs specific details from the Mimikatz alert. This screenshot displays the raw event data, highlighting the <code>hashes</code> field which contains the SHA1 hash (D1F783...). Crucially, within this same log, the SHA256 hash is also present, which will be the primary identifier used for reputation checks. This extraction step is vital for context-rich incident analysis.
              </p>
              <div class="project-details__img-cont">
                <img src="/assets/Automated SOC with SOAR Implementation/45-hashes.png" alt="Extracting Hashes from Alert Data" class="constrained-image" onclick="showOriginal(this)" />
              </div>

              <p class="project-details__desc-para">
                To automate the VirusTotal lookup, I implemented a "Regex capture group" action within Shuffle. This step is for extracting the SHA256 hash from the incoming Wazuh alert. As shown, the Input data is set to <code>$exec.text.win.eventdata.hashes</code>, targeting the field containing the hash string. The Regex used, <code>SHA256=([0-9A-Fa-f]{64})</code>, precisely identifies and captures the 64-character SHA256 value. This ensures that only the relevant hash is extracted, preparing it for the next step in our automated workflow.
              </p>
              <div class="project-details__img-cont">
                <img src="/assets/Automated SOC with SOAR Implementation/46-regex.png" alt="Regex Capture Group for SHA256" class="constrained-image" onclick="showOriginal(this)" />
              </div>

              <p class="project-details__desc-para">
                Here we can confirm extraction of the SHA256 hash.
              </p>
              <div class="project-details__img-cont">
                <img src="/assets/Automated SOC with SOAR Implementation/47-extracted.png" alt="SHA256 Hash Extraction Confirmed" class="constrained-image" onclick="showOriginal(this)" />
              </div>

              <p class="project-details__desc-para">
                With the SHA256 hash successfully extracted, I performed a lookup on VirusTotal to gather reputation information about the Mimikatz executable. It's time to use my VirusTotal API key to be able to parse this information.
              </p>
              <div class="project-details__img-cont">
                <img src="/assets/Automated SOC with SOAR Implementation/48-virustotal.png" alt="VirusTotal Lookup Setup" class="constrained-image" onclick="showOriginal(this)" />
              </div>

              <p class="project-details__desc-para">
                I set up a "Get a hash report" action within Shuffle. Here, I made sure to connect the extracted SHA256 hash to the VirusTotal query. You can see the Id field is populated with <code>$sha256_regex.group_0</code>, which pulls the hash directly from our previous parsing step. This ensures Shuffle automatically sends the right hash to VirusTotal for reputation analysis, weaving external threat intelligence right into our automated workflow.
              </p>
              <div class="project-details__img-cont">
                <img src="/assets/Automated SOC with SOAR Implementation/49-hash-report.png" alt="VirusTotal Hash Report Action" class="constrained-image" onclick="showOriginal(this)" />
              </div>

              <h4>Troubleshooting: VirusTotal API Error</h4>
              <p class="project-details__desc-para">
                After configuring the VirusTotal lookup, the workflow encountered an error. The screenshot shows a <code>status: 404</code> and an error message "Resource not found". This indicates that the API endpoint or the way the hash was being sent to VirusTotal was incorrect, preventing a successful lookup.
              </p>
              <div class="project-details__img-cont">
                <img src="/assets/Automated SOC with SOAR Implementation/50-error-virustotal.png" alt="VirusTotal API Error" class="constrained-image" onclick="showOriginal(this)" />
              </div>

              <p class="project-details__desc-para">
                To resolve the "Resource not found" error, I reviewed the available VirusTotal API actions within Shuffle. Here we can see the correct endpoint for retrieving a hash report: <code>GET /files/{id}</code>.
              </p>
              <div class="project-details__img-cont">
                <img src="/assets/Automated SOC with SOAR Implementation/51-correct-endpoint.png" alt="Correct VirusTotal API Endpoint" class="constrained-image" onclick="showOriginal(this)" />
              </div>

              <p class="project-details__desc-para">
                It means I just provided the wrong regex. I had to pick “list” here.
              </p>
              <div class="project-details__img-cont">
                <img src="/assets/Automated SOC with SOAR Implementation/52-list.png" alt="Correcting Regex to List" class="constrained-image" onclick="showOriginal(this)" />
              </div>

              <p class="project-details__desc-para">
                Here's the correct identifying API endpoint.
              </p>
              <div class="project-details__img-cont">
                <img src="/assets/Automated SOC with SOAR Implementation/53-success-virustotal.png" alt="Successful VirusTotal API Endpoint" class="constrained-image" onclick="showOriginal(this)" />
              </div>

              <p class="project-details__desc-para">
                After correcting the API endpoint, the VirusTotal lookup within Shuffle now shows a successful result. The output clearly indicates <code>malicious: 64</code> under <code>last_analysis_stats</code>, confirming that 64 out of the analyzed security vendors identified the file as malicious. This successful integration provides immediate, actionable threat intelligence directly within our automated workflow, verifying the malicious nature of the Mimikatz executable.
              </p>
              <div class="project-details__img-cont">
                <img src="/assets/Automated SOC with SOAR Implementation/54-malicious.png" alt="VirusTotal Malicious Detection" class="constrained-image" onclick="showOriginal(this)" />
              </div>

              <h3 class="project-details__content-title">TheHive Integration</h3>
              <p class="project-details__desc-para">
                Why do we need TheHive?
              </p>
              <p class="project-details__desc-para">
                I am going to follow here: <a href="https://wazuh.com/blog/using-wazuh-and-thehive-for-threat-protection-and-incident-response/" target="_blank">https://wazuh.com/blog/using-wazuh-and-thehive-for-threat-protection-and-incident-response/</a>. To begin integrating TheHive directly with Wazuh, I first navigated to the <code>/var/ossec/integrations</code> directory on the Wazuh Manager. Listing the contents of this directory, as shown, reveals the existing integration scripts such as <code>shuffle.py</code>, <code>virustotal.py</code>, and <code>slack.py</code>. This step confirms the location where custom integration scripts, like the one we'll use for TheHive, are stored and executed by Wazuh.
              </p>
              <div class="project-details__img-cont">
                <img src="/assets/Automated SOC with SOAR Implementation/55-custom-integration.png" alt="Wazuh Integrations Directory" class="constrained-image" onclick="showOriginal(this)" />
              </div>

              <p class="project-details__desc-para">
                To facilitate direct integration between Wazuh and TheHive, I created a new custom script named <code>custom-w2thive</code> within the <code>/var/ossec/integrations</code> directory. This script, written in Python, will act as the bridge, processing Wazuh alerts and forwarding them to TheHive. This custom solution allows for tailored incident creation and management directly from Wazuh, bypassing the need for an intermediary SOAR platform like Shuffle for this specific integration.
              </p>
              <div class="project-details__img-cont">
                <img src="/assets/Automated SOC with SOAR Implementation/56-w2thive.png" alt="Creating custom-w2thive Script" class="constrained-image" onclick="showOriginal(this)" />
              </div>

              <p class="project-details__desc-para">
                Here's the file I created.
              </p>
              <div class="project-details__img-cont">
                <img src="/assets/Automated SOC with SOAR Implementation/57-w2thive-content.png" alt="custom-w2thive Script Content" class="constrained-image" onclick="showOriginal(this)" />
              </div>

              <p class="project-details__desc-para">
                It needs the correct permissions, so I have to run these commands:
                <code>sudo chmod 755 /var/ossec/integrations/custom-w2thive.py</code>
                <code>sudo chmod 755 /var/ossec/integrations/custom-w2thive</code>
                <code>sudo chown root:wazuh /var/ossec/integrations/custom-w2thive.py</code>
                <code>sudo chown root:wazuh /var/ossec/integrations/custom-w2thive</code>
              </p>
              <div class="project-details__img-cont">
                <img src="/assets/Automated SOC with SOAR Implementation/58-permission.png" alt="Setting Permissions for custom-w2thive" class="constrained-image" onclick="showOriginal(this)" />
              </div>

              <p class="project-details__desc-para">
                To activate the direct integration, I modified the <code>ossec.conf</code> file on the Wazuh Manager, adding a new <code>&lt;integration&gt;</code> block for <code>custom-w2thive</code>. Here we can see the configuration details: the <code>hook_url</code> is set to TheHive server's IP and port <code>9000</code>, and a dedicated <code>api_key</code> is provided for authentication. The <code>alert_format</code> is specified as <code>json</code> to ensure structured data transfer.
              </p>
              <div class="project-details__img-cont">
                <img src="/assets/Automated SOC with SOAR Implementation/59-ossec-thehive.png" alt="Wazuh ossec.conf TheHive Integration" class="constrained-image" onclick="showOriginal(this)" />
              </div>

              <p class="project-details__desc-para">
                After restarting the Wazuh service, I navigated to TheHive's alert dashboard to verify the integration. Here we can see new alerts successfully received from Wazuh.
              </p>
              <div class="project-details__img-cont">
                <img src="/assets/Automated SOC with SOAR Implementation/60-alerts-hive.png" alt="TheHive Alert Dashboard" class="constrained-image" onclick="showOriginal(this)" />
              </div>

              <p class="project-details__desc-para">
                After re-executing Mimikatz on the Windows 10 endpoint, TheHive's alert dashboard immediately displayed a new, critical alert. As highlighted, the alert is titled "Mimikatz Usage Detected!!!" and directly references our custom Wazuh rule (<code>rule.id: 100002</code>). This confirms the seamless end-to-end integration: Wazuh detected the threat, and the custom integration script successfully forwarded the alert to TheHive for immediate case management. This automated alert creation significantly reduces response time and ensures critical incidents are promptly addressed.
              </p>
              <div class="project-details__img-cont">
                <img src="/assets/Automated SOC with SOAR Implementation/61-mima1.png" alt="Mimikatz Alert in TheHive 1" class="constrained-image" onclick="showOriginal(this)" />
              </div>
              <div class="project-details__img-cont">
                <img src="/assets/Automated SOC with SOAR Implementation/61-mima2.png" alt="Mimikatz Alert in TheHive 2" class="constrained-image" onclick="showOriginal(this)" />
              </div>

              <h3 class="project-details__content-title">Automated Notification: Sending Email to Analyst</h3>
              <p class="project-details__desc-para">
                To ensure the analyst is immediately notified of critical incidents, I added a "Send email shuffle" action to our workflow. Here we can see the email configuration: the recipient is set to <code>test@outlook.com</code>, the subject line is "High Severity Alert!", and the body dynamically populates key alert details. This includes the alert title (<code>$exec.title</code>), the original filename (<code>$exec.text.win.eventdata.originalFileName</code>), and the affected host (<code>$exec.text.win.system.computer</code>). This automated email ensures timely communication and prompts the analyst to begin their investigation in TheHive.
              </p>
              <div class="project-details__img-cont">
                <img src="/assets/Automated SOC with SOAR Implementation/62-email.png" alt="Automated Email Notification Configuration" class="constrained-image" onclick="showOriginal(this)" />
              </div>

              <p class="project-details__desc-para">
                After the full workflow execution, here we can see the successful delivery of the automated email notification to the analyst. The email, sent by the "Shuffle Email App," has the subject "High Severity Alert!" and dynamically includes critical details: "Mimikatz Usage Detected!!! File name: mimikatz.exe activity on host DESKTOP-G6HR1ED.". This final step in the SOAR playbook ensures that analysts are promptly informed of high-priority incidents, enabling them to initiate investigations swiftly.
              </p>
              <div class="project-details__img-cont">
                <img src="/assets/Automated SOC with SOAR Implementation/63.email.png" alt="Automated Email Notification Delivered" class="constrained-image" onclick="showOriginal(this)" />
              </div>

            </div>
          </div>
        </div>
      </div>
    </section>
    <footer class="main-footer">
      <div class="main-container">
        <div class="main-footer__upper">
          <div class="main-footer__row main-footer__row-1">
            <h4 class="heading heading-sm text-lt">John Doe</h4>
            <p class="main-footer__short-desc">
              Lorem ipsum dolor sit amet consectetur adipisicing elit facilis tempora explicabo quae quod deserunt
            </p>
          </div>
        </div>
        <div class="main-footer__lower">
          <p class="text-primary" style="font-size: 1.6rem;">
            &copy; Copyright 2021. Made by
            <a rel="noreferrer" target="_blank" href="https://rammaheshwari.com">Ram Maheshwari</a>
          </p>
        </div>
      </div>
    </footer>
    <div id="image-modal" class="modal">
      <span class="close" onclick="closeModal()">&times;</span>
      <img id="modal-img" class="modal-content" />
    </div>
    <script>
      const images = document.querySelectorAll('.constrained-image');
      const modal = document.getElementById("image-modal");
      const modalImg = document.getElementById("modal-img");

      modal.style.display = "none";

      images.forEach(img => {
        img.onload = () => {
          if (img.naturalWidth > 1890 || img.naturalHeight > 1100) {
            img.classList.add('larger');
          }
        };
        img.onclick = () => showOriginal(img.src); // Pass src directly
      });

      function showOriginal(src) {
        modalImg.src = src;
        modal.style.display = "flex";
      }

      function closeModal() {
        modal.style.display = "none";
      }
    </script>
  </body>
</html>
